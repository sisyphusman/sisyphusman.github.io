---
layout: post 
title: 컴퓨터 구조 CS:APP 1장 - 4 -
category: cs
---

# Index
- [운영체제는 하드웨어를 관리한다](#운영체제는-하드웨어를-관리한다)
- [프로세스](#프로세스)
- [쓰레드(Thread)](#쓰레드thread)
- [가상메모리](#가상메모리)
- [파일](#파일)


#### 운영체제는 하드웨어를 관리한다

프로그램이 장치나 메인 메모리에 직접 엑세스하지 않음

응용프로그램이 하드웨어를 제어하려면 언제나 **운영체제(Operating System)**를 통해서 해야 한다

운영체제의 목적

- 응용프로그램들이 하드웨어를 잘못 사용하는 것을 막기 위해 

- 프로그램들이 단순하고 균일한 매커니즘 사용하여 복잡하고 매우 다른 저수준 하드웨어 장치들을 조작할 수 있도록 하기 위해

이 두가지 목표를 아래와 같은 추상화를 통해 이루어진다


![컴퓨터 시스템의 계층화 모습과 운영체제에 의한 추상화](/assets/images/cs/cs-app/cs-app-01-04-01.png)

&nbsp;

#### 프로세스

프로세스는 프로그램에 대한 운영체제의 **추상화**

다수의 프로세스들은 동일한 시스템에서 동시에 실행될 수 있음

**동시에(concurrently)**라는 말은 한 프로세스의 인스트럭션들이 다른 프로세스의 인스트럭션들과 섞인다는 것을 의미

운영체제는 **문맥 전환(Context Switching)**을 사용하여 교차실행을 수행

**컨텍스트**라고 부르는 상태정보(PC, 레지스터 파일, 메인 메모리의 현재 값)을 이용하여 운영체제는 프로세스를 추적

운영체제는 현재 프로세스의 컨텍스트를 저장하고 새 프로세스의 컨텍스트를 복원시키는 문맥전환을 실행하여 **제어권**을 새 프로세스에 넘겨줌

프로그램을 실행하면 쉘은 **시스템 콜**이라는 특수 함수를 호출함

운영체제는 쉘의 컨텍스트를 저장한 뒤, 새로운 프로세스와 컨텍스를 생성 -> 제어권을 새로운 프로세스로 넘겨줌

실행하던 프로그램 종료 -> 운영체제는 쉘 프로세스 컨텍스트 복구 -> 제어권을 넘겨주며 다음 명령어를 기다림

&nbsp;

![프로세스 문맥전환](/assets/images/cs/cs-app/cs-app-01-04-02.png)


프로세스에서 다른 프로세스로의 전환은 운영체제 커널에 의해 관리

커널(kernel)은 운영체제의 코드의 일부분으로서 메모리에 상주함

응용 프로그램 -> 운영체제 -> 파일 읽기나 쓰기 같은 특정 시스템콜을 실행 -> 커널에 제어를 넘김

커널은 요청된 작업을 수행 -> 응용 프로그램으로 리턴 (쉘은 프로세스이지만, 커널은 **별도의 프로세스**가 아님)

&nbsp;

#### 쓰레드(Thread)

프로세스가 **쓰레드**라고 하는 다수의 실행 유닛으로 구성

각 쓰레드는 프로세스의 컨텍스트에서 실행, 동일한 코드와 전역 데이터를 공유

다수의 프로세스들에서보다 **데이터의 공유가 더 쉽다**

**쓰레드**가 프로세스보다 더 **효율적**이다

&nbsp;

#### 가상메모리

각 프로세스들이 메인 메모리 전체를 독점적으로 사용하고 있는 것 같은 환상을 제공하는 추상화가 **가상메모리**이다

리눅스에서, 주소공간의 **최상위 영역**은 모든 프로세스들이 공통으로 사용하는 **운영체제의 코드와 데이터**를 위한 공간

리눅스 프로세스들의 가상주소 공간이 아래 그림처럼 나와있다

![프로세스 가상주소공간](/assets/images/cs/cs-app/cs-app-01-04-03.png)

- 프로그램 코드와 데이터: 모든 프로세스들이 같은 **고정 주소**에서 시작하며, 다음에 C **전역변수**에 대응되는 데이터 위치들이 따라옴

- 힙 Heap: 힙은 프로세스가 실행되면서 C 표준함수인 malloc이나 free를 호출하면서 **런타임에 동적**으로 그 크기가 늘었다 줄어듦

- 공유 라이브러리: 주소공간 중간 부근에 C 표준 라이브러리나 수학 라이브러리와 같은 **공유 라이브러리**의 코드와 데이터를 저장하는 영역이 있음

- 스택: 사용자 가상 메모리 맨 위, 컴파일러가 함수 호출을 구현하기 위해서 사용하는 **사용자 스택**이 위치, 힙과 마찬가지로 **동적**임 (함수 호출시 늘었다가 리턴할때 줄어듬)

- 커널 가상메모리: 주소공간 맨 윗부분은 커널을 위해 예약되어 있음   
  응용 프로그램들이 이 영역의 내용을 **읽거나 쓰는 것**을 금지(이런 작업을 수행하기 위해서는 **커널**을 호출해야 함)

  &nbsp;

#### 파일

> 파일 = 연속된 바이트들 모든 입출력장치는 파일로 모델링함

- 시스템의 모든 입출력은 유닉스 I/O라는 시스템 콜을 이용하여 파일을 읽고 쓰는 형태로 이루어짐

- 다양한 입출력장치들을 파일이라는 통일된 관점을 제공함

<p style="display: flex; justify-content: space-between;">
<a href="cs-01-03.html">이전</a>
<a href="cs-01-05.html">다음</a>
</p>